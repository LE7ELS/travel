<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>ÂèëÂ∏ÉÊñ∞ÊôØÁÇπ</title>

        <!-- Bootstrap core CSS -->
        <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

        <!-- Additional CSS Files -->
        <link rel="stylesheet" href="assets/css/fontawesome.css" />
        <link rel="stylesheet" href="assets/css/templatemo-style.css" />
        <link rel="stylesheet" href="assets/css/owl.css" />
    </head>
    <body>
        <!-- Wrapper -->
        <div id="wrapper">
            <!-- Main -->
            <div id="main">
                <div class="inner">
                    <!-- Header -->
                    <header id="header">
                        <div class="logo">
                            <a href="login.html">Ê∏∏ÂÆ¢ÔºåËØ∑ÁôªÂΩï</a>
                        </div>
                    </header>

                    <!-- Page Heading -->
                    <div class="page-heading">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-md-12">
                                    <h1>ÂèëÂ∏ÉÊñ∞ÊôØÁÇπ</h1>
                                    <p>
                                        Âú®ËøôÈáåÂèëÂ∏É‰Ω†Êñ∞ÂèëÁé∞ÁöÑÂÆùËóèÊôØÁÇπÂêßÔºÅ
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÊôØÁÇπÂèëÂ∏ÉË°®Âçï -->
                    <section class="forms">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-md-12">
                                    <form
                                        id="newSpotForm"
                                        method="post"
                                        enctype="multipart/form-data"
                                    >
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="spotName"
                                                    >üèïÊôØÁÇπÂêç</label
                                                >
                                                <input
                                                    type="text"
                                                    class="form-control"
                                                    name="spotName"
                                                    id="spotName"
                                                    placeholder="ÊôØÁÇπÂêç"
                                                    required
                                                />
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="publisher"
                                                    >üßö‚ÄçÂèëÂ∏ÉËÄÖ</label
                                                >
                                                <input
                                                    type="text"
                                                    class="form-control"
                                                    name="publisher"
                                                    id="publisher"
                                                    value="ËØ∑ÂÖàÁôªÂΩïÔºÅ"
                                                    readonly
                                                />
                                            </div>
                                        </div>

                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="seasons"
                                                    >üå§ÊúÄ‰Ω≥Ê∏∏Áé©Â≠£ËäÇ</label
                                                >
                                                <select
                                                    name="seasons"
                                                    id="seasons"
                                                >
                                                    <option value="1"
                                                        >Êò•Â≠£</option
                                                    >
                                                    <option value="2"
                                                        >Â§èÂ≠£</option
                                                    >
                                                    <option value="3"
                                                        >ÁßãÂ≠£</option
                                                    >
                                                    <option value="4"
                                                        >ÂÜ¨Â≠£</option
                                                    >
                                                    <option value="5"
                                                        >Êò•Áßã</option
                                                    >
                                                    <option value="6"
                                                        >ÂõõÂ≠£ÁöÜÂÆú</option
                                                    >
                                                </select>
                                            </div>

                                            <div class=" form-group col-md-6">
                                                <label for="price"
                                                    >üí¥Á•®‰ª∑</label
                                                >
                                                <div class="input-group">
                                                    <div
                                                        class="input-group-prepend"
                                                    >
                                                        <span
                                                            class="input-group-text"
                                                            >Ôø•</span
                                                        >
                                                    </div>
                                                    <input
                                                        type="text"
                                                        onkeyup="value=value.replace(/^(-1+)|[^\d]+/g,'')"
                                                        class="form-control"
                                                        name="ticket"
                                                        id="ticket"
                                                        placeholder="Á•®‰ª∑"
                                                        required
                                                    />
                                                    <div
                                                        class="input-group-prepend"
                                                    >
                                                        <span
                                                            class="input-group-text"
                                                            >.00</span
                                                        >
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="position">üö©Âú∞ÂùÄ</label>
                                            <input
                                                type="text"
                                                class="form-control"
                                                name="position"
                                                id="position"
                                                placeholder="ÊôØÁÇπÂú∞ÂùÄ"
                                                required
                                            />
                                        </div>

                                        <div class="form-group">
                                            <label for="spotDesc"
                                                >üèùÊôØÁÇπÊèèËø∞</label
                                            >
                                            <textarea
                                                name="spotDesc"
                                                id="spotDesc"
                                                placeholder="ÊôØÁÇπÊèèËø∞"
                                                cols="30"
                                                rows="10"
                                                required
                                            ></textarea>
                                        </div>

                                        <div class="input-group mb-5">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"
                                                    >üèïÔ∏è‰∏ä‰º†ÊôØÁÇπÂõæÁâá</span
                                                >
                                            </div>
                                            <div class="custom-file">
                                                <input
                                                    type="file"
                                                    class="custom-file-input"
                                                    name="album"
                                                    id="album"
                                                    required
                                                />
                                                <label
                                                    class="custom-file-label"
                                                    for="album"
                                                    >ÁÇπÂáªÈÄâÊã©ÂõæÁâá</label
                                                >
                                            </div>
                                        </div>

                                        <div class="form-group mb-5">
                                            <label for="preview"
                                                >ÂõæÁâáÈ¢ÑËßàüëáüëáüëá</label
                                            >
                                            <div id="preview"></div>
                                        </div>
                                        <a
                                            href=""
                                            class="btn btn-primary"
                                            onclick="addSpot()"
                                        >
                                            ÂèëÂ∏ÉÊôØÁÇπ
                                        </a>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- sidebar -->
            <div id="sidebar">
                <div class="inner">
                    <!-- Search Box -->
                    <section id="search" class="alt">
                        <form onsubmit="return false" id="keyWordForm">
                            <input
                                type="text"
                                id="keyword"
                                placeholder="ÊêúÁ¥¢ÊôØÁÇπ..."
                            />
                        </form>
                    </section>

                    <!-- Menu -->
                    <nav id="menu">
                        <ul>
                            <li><a href="index.html">ÊúÄÊñ∞ÊôØÁÇπ</a></li>
                            <li><a href="post-add.html">ÂèëÂ∏ÉÊñ∞ÊôØÁÇπ</a></li>
                            <li><a href="post-manage.html">ÊôØÁÇπÁÆ°ÁêÜ</a></li>
                        </ul>
                    </nav>

                    <!-- Featured Posts -->
                    <div class="featured-posts">
                        <div class="heading">
                            <h2>ÂÖçË¥πÊôØÁÇπÊé®Ëçê</h2>
                        </div>
                        <div id="selected" class="owl-carousel owl-theme"></div>
                    </div>

                    <!-- Footer -->
                    <footer id="footer">
                        <p class="copyright">
                            UMLËØæËÆæ@1600300626ÁéãÊù∞Âüé
                        </p>
                    </footer>
                </div>
            </div>
        </div>

        <!-- Scripts -->
        <!-- Bootstrap core JavaScript -->
        <script src="vendor/jquery/jquery.min.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

        <script src="assets/js/browser.min.js"></script>
        <script src="assets/js/breakpoints.min.js"></script>
        <script src="assets/js/transition.js"></script>
        <script src="assets/js/owl-carousel.js"></script>
        <script src="assets/js/custom.js"></script>

        <script src="./assets/js/base.js"></script>
        <!-- ‰ΩøÁî®jQuery-form.jsÊèí‰ª∂ -->
        <script src="./assets/js/jquery-form.js"></script>
        <script>
            $(function() {
                // Ê∏∏ÂÆ¢Ë∫´‰ªΩÊèêÁ§∫
                if (!landed().isLanded) {
                    $('#header').after(`
                    <div
                        class="alert alert-warning alert-dismissible fade show"
                        role="alert"
                        style="margin-bottom: 100px"
                    >
                        ÊÇ®Áé∞Âú®Â§Ñ‰∫éÊ∏∏ÂÆ¢Áä∂ÊÄÅÔºåÂ¶ÇÈúÄÊèê‰∫§ÊôØÁÇπËØ∑ÂÖàÁôªÂΩïÔºÅ
                        <button
                            type="button"
                            class="close"
                            data-dismiss="alert"
                            aria-label="Close"
                        >
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    `)

                    // Êèê‰∫§ÊåâÈíÆ‰∏çÂèØÁî®
                    $('#addNewSpot')
                        .attr('disabled', true)
                        .text('ËØ∑ÁôªÂΩïÔºÅ')
                } else {
                    $('#publisher').val(`${landed().landedUser}`)
                }

                // Ëé∑ÂèñÂÖçË¥πÁöÑÊé®ËçêÊôØÁÇπ
                getSelectedSpots()

                // ÁÇπÂáªÁôªÂá∫
                $('.logo a').click(function() {
                    localStorage.clear('myToken')
                    location.href = 'login.html'
                })
            })

            // Ë°®ÂçïÊèê‰∫§(Âê´Êñá‰ª∂‰∏ä‰º†)
            function addSpot() {
                console.log('Ë°®ÂçïÊèê‰∫§')
                $('#newSpotForm').ajaxSubmit({
                    async: false,
                    url: rootPath + '/spots/addSpot',
                    method: 'POST',
                    success: function(result) {
                        console.log(result.msg)
                        alert(result.msg)
                    },
                    error: function(error) {
                        console.log(error)
                    }
                })
            }

            // Ëé∑ÂèñÂÖçË¥πÁöÑÊé®ËçêÊôØÁÇπ
            function getSelectedSpots() {
                $.ajax({
                    async: false,
                    url: rootPath + '/spots/getFreeSpots',
                    method: 'GET',
                    success: function(result) {
                        console.log('Ëé∑ÂèñÁöÑÂÖçË¥πÊé®ËçêÊôØÁÇπ', result)
                        var selected = ''

                        // Ê∏ÖÁ©∫ÂéüÊúâÊï∞ÊçÆ
                        $('#selected').empty()

                        if (result.data.length == 0) {
                            console.log(result.msg)
                            return
                        }
                        // Êï∞ÊçÆÂØπË±°ÈÅçÂéÜ
                        $(result.data).each(function(index, obj) {
                            let album = staticFile + obj.album

                            selected = `
                            <a href="#">
                                <div class="featured-item">
                                    <img
                                        src="${album}"
                                        alt="${obj.album}"
                                    />
                                    <p>
                                        ${obj.name}
                                    </p>
                                </div>
                            </a>`
                            // DOMÁîüÊàê
                            $('#selected').append(selected)
                        })
                    },
                    error: function(error) {
                        console.log(error)
                    }
                })
            }

            // ÂõæÁâá‰∏ä‰º†È¢ÑËßà
            $('#album').on('change', function() {
                if (typeof FileReader != 'undefined') {
                    var preview = $('#preview')
                    preview.empty()
                    var reader = new FileReader()
                    reader.onload = function(e) {
                        $('<img />', {
                            src: e.target.result,
                            class: 'thumb-image'
                        }).appendTo(preview)
                    }
                    preview.show()
                    reader.readAsDataURL($(this)[0].files[0])
                } else {
                    alert('ÊµèËßàÂô®‰∏çÊîØÊåÅFileReaderÔºåËØ∑‰ΩøÁî®ÊîØÊåÅÁöÑÊµèËßàÂô®‰∏ä‰º†')
                }
            })

            // Âà§Êñ≠ÂΩìÂâçÊòØÂê¶Â∑≤ÁôªÈôÜ
            function landed() {
                var my_token = localStorage.myToken
                var landedStatus = {
                    isLanded: false,
                    landedUser: 'Êú™ÁôªÂΩï'
                }
                // È°µÈù¢Âä†ËΩΩÂÆåÊàêÊó∂ËØ∑Ê±Ç
                $.ajax({
                    async: false,
                    url: rootPath + '/users/current',
                    method: 'GET',
                    headers: {
                        Authorization: my_token
                    },
                    success: function(result) {
                        console.log('ÊàêÂäüÁöÑÂõûË∞ÉÔºö' + result.msg)
                        if (result.code == 200) {
                            // DOMÊ∏≤Êüì
                            $('.logo a').text(
                                result.data.username + 'ÔºåÁÇπÂáªÁôªÂá∫'
                            )
                            landedStatus.isLanded = true
                            landedStatus.landedUser = result.data.username
                        }
                    },
                    error: function(error) {
                        console.log(error.statusText)
                    }
                })

                return landedStatus
            }
        </script>
    </body>
</html>
